<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Simon!!!</title>
    <style>
        span {
            font-weight: bold;
        }

        .nope {
            display: none;
        }
    </style>
    <script>
        var old;

        const regex1 = /{"keys_left": (\d+), "image": "([a-z0-9-]+)\.png", "keys_consumed_last_minute": (\d+), "last_used_epickey": "([a-z0-9-]+)", "next-available-steam-key": "([a-z0-9-]+)"}/ig;
        const regex2 = /{"keys_left": (\d+), "image": "([a-z0-9-]+)\.png", "keys_consumed_last_minute": (\d+), "last_used_epickey": "([a-z0-9-]+)", "next-available-steam-key": "([a-z0-9-]+)", "simon-says": "(.*)"}/ig;

        function parse() {
            let regex = old?regex1:regex2;
            let input = document.getElementById("inputt").value;
            let num_groups = (new RegExp(regex.source + '|')).exec('').length;
            let arr = input.split('\n');
            let m;
            let arrr = [];

            console.log(old);
            console.log(num_groups);


            for (let i = 0; i < num_groups; i++) {
                arrr.push([]);
            }

            arr.forEach((str, index) => {
                while ((m = regex.exec(str)) !== null) {
                    if (m.index === regex.lastIndex) {
                        regex.lastIndex++;
                    }

                    m.forEach((match, groupIndex) => {
                        arrr[groupIndex].push(match);
                    }
                    );
                }
            });

            let ress = [];
            for (let i = 1; i < num_groups; i++) {
                ress[i] = Array.from(new Set(arrr[i]));
                document.getElementById("s" + i).innerText = ress[i].length;
                document.getElementById("out" + i).value = ress[i].join('\n');
            }

            document.getElementById("s0").innerText = arr.length;
            document.getElementById("stat").setAttribute('style', 'display: block');
        }

        function load(filename) {
            var request = new XMLHttpRequest();

            request.onreadystatechange = function () {
                if (request.readyState === 4) {
                    if (request.status === 200) {
                        document.getElementById("inputt").value = request.responseText;
                    } else {
                        document.getElementById("inputt").value = 'An error occurred during your request: ' + request.status + ' ' + request.statusText;
                    }
                }
            }

            request.open('Get', filename);

            request.send();
        }

    </script>
</head>

<body>
    <div>
        <textarea id="inputt" style="width: 100%; height: 400px;"></textarea>
    </div>
    <button onclick="parse()">Go!</button>
    <button onclick="{old = true; load('txt.txt');}">Load data</button>
    <button onclick="{old = true; load('txt2.txt');}">Load data 2</button>
    <button onclick="{old = false; load('txt3.txt');}">Load data 3</button>
    <div>
        <textarea id="out1" style="width: 16%; height: 400px;" readonly></textarea>
        <textarea id="out2" style="width: 16%; height: 400px;" readonly></textarea>
        <textarea id="out3" style="width: 16%; height: 400px;" readonly></textarea>
        <textarea id="out4" style="width: 16%; height: 400px;" readonly></textarea>
        <textarea id="out5" style="width: 16%; height: 400px;" readonly></textarea>
        <textarea id="out6" style="width: 16%; height: 400px;" readonly></textarea>
    </div>
    <div id="stat" class="nope">
        For <span id="s0"></span> results there are <span id="s1"></span> different key counts, <span id="s2"></span>
        pictures of Simon, <span id="s3"></span> key decrements, <span id="s4"></span> Epic keys (??) and
        <span id="s5"></span> Steam keys. Simon says <span id="s6"></span> different phrases.
    </div>
</body>

</html>